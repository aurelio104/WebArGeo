<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>WebAR GPS Profesional</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <meta name="theme-color" content="#000000" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <link rel="icon" href="data:," />

  <!-- Estilos -->
  <link rel="stylesheet" href="css/style.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

  <style>
    a-scene {
      pointer-events: none;
    }
    #tap-para-iniciar {
      pointer-events: auto !important;
    }
  </style>

  <!-- A-Frame + AR -->
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="js/arjs-gps-custom.js"></script>
  <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>

  <!-- L√≥gica principal -->
  <script src="js/app.js" defer></script>
</head>

<body>
  <!-- Video de fondo -->
  <video id="video-fondo" autoplay playsinline webkit-playsinline style="display: none;"></video>

  <!-- UI HUD -->
  <div id="hud">
    <div><strong>GPS WebAR</strong></div>
    <div id="status">Buscando ubicaci√≥n...</div>
  </div>

  <!-- Botones UI -->
  <div id="botones">
    <button id="btn-mostrar" class="boton-ui" onclick="mostrarTodos()">
      <i class="fas fa-map-marker-alt"></i> <span>Ver todos</span>
    </button>
    <button id="btn-centrar" class="boton-ui" onclick="centrarUsuario()">
      <i class="fas fa-crosshairs"></i> <span>Centrar</span>
    </button>
    <button id="btn-idioma" class="boton-ui" onclick="cambiarIdioma()">
      <i class="fas fa-globe"></i> <span>Idioma</span>
    </button>
    <button id="btn-reintentar" class="boton-ui" onclick="location.reload()" style="display: none;">
      <i class="fas fa-redo"></i> <span>Reintentar ubicaci√≥n</span>
    </button>
  </div>

  <!-- Minimapa -->
  <div id="minimapa">
    <div class="yo-radar"></div>
  </div>

  <!-- Escena A-Frame -->
  <a-scene embedded vr-mode-ui="enabled: false" renderer="logarithmicDepthBuffer: true;">
    <a-camera gps-camera rotation-reader></a-camera>
  </a-scene>

  <!-- Overlay para forzar interacci√≥n -->
  <div id="tap-para-iniciar" style="
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.85);
    color: white;
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    pointer-events: auto;
    font-size: 18px;
    text-align: center;
    padding: 20px;
  ">
    üìç Toca la pantalla para activar ubicaci√≥n y c√°mara
  </div>

  <!-- Activaci√≥n forzada -->
  <script>
    ['click', 'touchstart'].forEach(evt => {
      window.addEventListener(evt, () => {
        const overlay = document.getElementById('tap-para-iniciar');
        if (overlay) overlay.remove();

        if (typeof DeviceOrientationEvent !== 'undefined' &&
            typeof DeviceOrientationEvent.requestPermission === 'function') {
          DeviceOrientationEvent.requestPermission().catch(() => {}).then(() => {});
        }

        navigator.geolocation.watchPosition(
          (pos) => {
            const lat = pos.coords.latitude.toFixed(5);
            const lon = pos.coords.longitude.toFixed(5);
            document.getElementById('status').innerText = `Lat: ${lat}, Lon: ${lon}`;
            console.log('üìç Ubicaci√≥n desde interacci√≥n:', lat, lon);
          },
          (err) => {
            console.warn('‚ùå Error tras toque:', err);
            document.getElementById('status').innerText = "Error al obtener ubicaci√≥n (interacci√≥n)";
          },
          {
            enableHighAccuracy: true,
            timeout: 20000,
            maximumAge: 0
          }
        );

        document.querySelector('a-scene').style.pointerEvents = 'auto';
      }, { once: true });
    });
  </script>
</body>
</html>
